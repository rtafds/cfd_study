＜直交に近い格子＞

　このプログラムはもとの格子から直交に近い格子を本文で述べた手順で生成するプログラムである。配列Ｘ、Ｙは座標値、Ｔは作業用の配列である。プログラムとARRANGE.FOR と同様、もとのＸ、Ｙは保存しない。DO 10 のループで各ηごとに並べ変えを行う。はじめにあるｉについて法線の傾きを計算するが、ｙ軸に平行な場合は傾きが無限大になり計算ができないため、適当に絶対値の大きい数におきかえる。DO 31 のループで（Ａ１，Ｂ１）が交点Ｐの座標であり、この点が実際に求めている点であるかどうかを(5.112) と類似の式を用いて判断している。計算時間を短縮するため、本文で説明したとおりＩ、Ｉ＋１、Ｉ−１、・・・の順に調べている。新しい座標Ｔが、各Ｉについてもとまったあとで、DO 50 のループでまとめてＴをＸ、Ｙにおきかえている。

　サブルーチン　ELLIP の仕様

　　配列　Ｘ　----  格子点のＸ座標を記憶する配列
　　配列　Ｙ　----  格子点のＹ座標を記憶する配列
　　配列　Ｔ　----  格子点の座標を一時的に記憶する配列
　　変数　MX,MY --  主プログラムの配列の大きさを指定するパラメータ
　　変数　NX,NY --  ξ、η方向の格子点数
　　変数　T1  ----  着目している格子線と直交する直線の傾き
　　変数　A1,B1 --  着目している格子点を通り傾きT1の直線と次の格子線との
　　　　　　　　　　交点のＸ、Ｙ座標
　　変数　II  ----  (A1,B1) が(II,J),(II+1,J) の間にある
    変数　QQ  ----  (II,J)と(II+1,J)の間の距離
    変数　Q1  ----  (II,J)と(A1,B1) の間の距離
    変数　Q2  ----  (A1,B1) と(II+1,J)の間の距離

