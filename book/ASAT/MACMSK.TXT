＜多くの障害物のあるダクト内の流れ＞

　このプログラムは多くの障害物のあるダクト内の流れをＭＡＣ法を用いて解析するプログラムである。ここでは簡単のためスタガードではなく通常格子を用いている。
　配列Ｕ、Ｖ、Ｐはそれぞれ速度、圧力の配列である。Ｑ、Ｄはポアソン方程式の右辺および div Ｖ 用の配列であるが、その他に作業用としても用いる。Ｓは境界の圧力を記憶する配列である。配列MARK、IBD は整数型であり、本文で述べたとおり流体の有無および境界の位置を記憶するものである。I21、J21はＸ、Ｙ方向の格子数、DTは時間刻みΔt 、REはレイノルズ数、LMは最大反復回数である。格子は長方形を用いるが不等間隔でよい。そのため格子数および格子座標をファイルから読み込む。また障害物がどの格子に対応するかを示す配列 MARK も同時に読み込む。ただしITEST = 1 または 2のときはテスト計算のためのデータを作成する。（1:３つの長方形の障害物がある場合　2:円柱がある場合）
　４章１．１節でのべたように不等間隔格子を用いて計算する場合、微分の評価は場所に依存するため、係数ａ1−ｄ4に対応する配列Ａ１−Ｄ４を用意しあらかじめ計算しておくにが便利である。DO 11、DO 91はそのためのものである。次にDO 230、DO 250のループで、本文でのべた方法で境界セルを検出する。なおここでは境界がどの方向を向いているかは区別せずに境界セルの場合はIBD を１、そうでない場合はIBD を０としている。DO 270のループでは境界の種類によって重みを計算しIWT に記憶している。DO 20 のループは初期条件であり、ｕ＝１、ｖ＝０、Ｐ＝０を与えている。
  DO 30 のループでひとつのタイムステップを構成する。DO 40、DO 41のループはダクト流入出口、上下壁の境界条件である。DO 22 のループでポアソン方程式の右辺Ｑを計算する。DO 23 のループでポアソン方程式をヤコビ法で解いている。DO 285のループで障害物の境界上における圧力を計算している。本来は速度に関する条件も式のなかにはいるが、ここでは簡単のために
　　　　　　∂Ｐ／∂ｎ＝０
で代用している。結果として得られるＳは境界の部分だけで上式を満たし、あとは無意味な値が入る。次にDO 286のループで流体部分の圧力は変化させず、境界で正しい圧力（Ｐ）に変化させるという操作を行っている。DO 24 、DO 25 は流出入口、上下面での境界条件である。次にDO 26 でヤコビ法を用いて圧力を変化させる。変化量の差の二乗和が許容値EPS 以下になると収束したとみなし、DO  23 のループをぬける。DO 27 のループで速度を計算し、一時的にＱ、Ｄに保存したあとDO 245のループでＱ、ＤをＵ、Ｖにおきかえる。このとき全体に IFLをかけているため、境界を含め障害物上でＵ、Ｖは０となり、粘着条件が満足されることになる。DO 120のループは結果のファイルへの出力である。OUT3は計算結果の簡単な表示プログラムである。

　メインプログラムの仕様

　　配列　Ｕ　----  Ｘ方向速度Ｕを記憶する配列
　　配列　Ｖ　----  Ｙ方向速度Ｖを記憶する配列
　　配列　Ｐ　----  圧力Ｐを記憶する配列
　　配列　Ｒ　----  ポアソン方程式の右辺（ソース項）を記憶する配列、
　　　　　　　　　　Ｖの一時記憶場所や計算終了後の流れ関数の記憶場所
　　　　　　　　　　としても用いる。
　　配列　Ｑ　----  div V を記憶する配列、Ｕの一時記憶場所
　　配列　Ｄ  ----  ポアソン方程式を解くとき用いる係数
　　配列　Ｓ  ----  境界の圧力を記憶する配列
　　配列　IFL  ---  流体の有無を記憶する配列
　　配列　IBD  ---  境界の位置を記憶する配列
　　配列　IWT  ---  境界の種類を記憶する配列
　　配列　UL　----  圧力の反復法での修正量
　　配列　XG,YG --  Ｘ、Ｙの一階微係数を計算するときででくる係数
　　配列　XA,XB --  Ｘの二階微係数を計算するときでてくる係数
　　配列　YA,YB --  Ｙの二階微係数を計算するときでてくる係数
　　配列　XC,XD --  ポアソン方程式の差分近似式に現れる係数
　　配列　YC,YD --  ポアソン方程式の差分近似式に現れる係数
　　配列　A4,B4,C4  ∂2〇／∂Ｙ2＝A2*〇(I,J-1)+B2*〇(I,J)+C2*〇(I,J+1)
　　変数　ID,JD --  プログラムの配列の大きさを指定するパラメータ
　　変数　DT  ----  時間間隔
　　変数　RE  ----  レイノルズ数
　　変数　LM  ----  計算打ち切りのタイムステップ数
　　変数　IR  ----  1:以前の計算結果を読み込む　0:初期から計算
　　変数　I21,J21-  Ｘ、Ｙ方向の格子点数(I21=ID,J21=JD)
　　変数　I11,J11-  それぞれ中央の格子点番号 (I21+1)/2、(J21+1)/2
　　変数　TD  ----  時間間隔の逆数
　　変数　R1  ----  レイノルズ数の逆数
　　変数　I20,I19-  それぞれ I21-1、I21-2
　　変数　J20,J19-  それぞれ J21-1、J21-2
　　変数　KM  ----  圧力に関するポアソン方程式の近似差分方程式を
　　　　　　　　　　ガウス−ザイデル法で解くときの最大反復回数
　　変数　ITEST --  1,2 :テスト計算（1:３つの長方形まわりの流れ
　　　　　　　　　　2:円柱まわりの流れ）をする　0:しない
　　変数　STL  ---  中心から格子点までの距離
　　変数　I35,J35-  格子をファイルから読み込んだ場合のξ、η方向格子数
　　変数　IQQ  ---  境界のタイプを判別する整数
　　変数　U1,U2 --  ∂Ｕ／∂Ｘ、∂Ｕ／∂Ｙ
　　変数　V1,V2 --  ∂Ｖ／∂Ｘ、∂Ｖ／∂Ｙ
　　変数　G1  ----  すべての内部格子点での圧力の相対誤差の二乗和
    変数　UNX,UNY-  それぞれＵ∂Ｕ／∂Ｘ、Ｖ∂Ｕ／∂Ｙ
    変数　VNX,VNY-  それぞれＵ∂Ｖ／∂Ｘ、Ｖ∂Ｖ／∂Ｙ
　　変数　UV,VV --  それぞれ△Ｕ、△Ｖ
　　変数　IWRITE -  １のとき計算結果をファイルに記録する。それ以外の
　　　　　　　　　　ときは記録しない。

　サブルーチン OUT3 の仕様

　　配列　Ｕ　----  Ｘ方向の速度を記憶する配列
　　配列　Ｐ　----  表示する物理量（流れ関数）を記憶する配列
　　配列　INDEX --  表示する物理量を規格化し２桁の整数にして記憶する配列
　　配列　Ｚ　----  INDEX の偶奇によって文字を割当てて記憶する配列
　　配列　IFL  ---  流体の有無を記憶する配列
　　変数　ID,JD --  プログラムの配列の大きさを指定するパラメータ
　　変数　I21,J21-  Ｘ、Ｙ方向の格子点数
　　変数　PMIN,PMAX Ｐの最小値、最大値
　　変数　XQ,YQ --  表示したい点の座標
　　変数　IQ,JQ --  表示したい点が含まれている格子の格子番号（IQ,JQ）
　　変数　F0,･･,F4  表示したい点の物理量を近くの格子点から補間する
　　　　　　　　　　ときに用いる係数。
    変数　PP  ----  表示したい点での物理量の補間値
　　変数　IND ----  PPを規格化して何倍かした量

