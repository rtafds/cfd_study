　プログラムＭＡＳＫ３Ｄ．ＦＯＲ

　このプログラムは任意形状の領域での流れを領域形状を直角座標系で近似して解くプログラムである。領域における流体の有無や領域形状の種類などは整数型の配列を用いて区別される。解法はＭＡＣ法を用いているため、プログラムの基本構成は３次元キャビティ問題や室内気流の問題と同じである。このプログラムもプログラム内のコメント文を読めばおおよそ何を行っているのか検討がつくと思われるが簡単に説明すると以下のようになる。
　はじめに計算に用いる配列を確保したのち、READ文で計算に必要なパラメータの読み込み（入力例はWRITE 文に記されている）、計算に使う変数の計算を行う。次に格子点の座標を計算する。立方体領域内の流れで境界近くで密になる格子、および正方形の断面をもったダクト内の流れで流れに垂直な面内で等間隔格子、流れ方向には出口近くで粗くなる格子の２種類の格子を生成している。もちろん別の格子をファイルから読むようにもできる。立方体内の流れではDO 110, DO 115, DO 120のループでそれぞれ格子のｘ、ｙ，ｚ座標を計算する。ダクト内の流れではDO 201, DO 202, DO 203, DO 204の各ループで格子の座標を計算している。なお前者の格子を生成する場合には本文の式(1.  )を用いている。次にDO 11, DO 91, DO 92 のループで座標変換を行ったときに現れる導関数の係数を計算している。
  DO 220, DO 205のループではダクト内に球と直方体の障害物のある流れを想定し流体の有無を判別する配列を定義し、あわせて今後計算過程で用いる配列の初期化（０とする）を行っている。DO 230, DO 250, DO 260, DO 291のループでは流体の有無を判別する配列から流体と物体との境界面を識別する配列を計算している。またDO 270のループでは圧力のポアソン方程式の境界条件のところで用いる境界の種類を判別する配列を計算している。DO 20 のループは初期条件である。
　DO 30 のループが時間発展的に基礎方程式を解いていくＭＡＣ法の時間発展の大きなループを構成する。DO 40, DO 41, DO 43 の各ループで速度に関する境界条件を与えている。DO 15 のループは圧力のポアソン方程式を反復法で解く場合に現れる係数を計算している。DO 22 のループで圧力のポアソン方程式の右辺（ソース項）を計算している。
　DO 23 のループで圧力のポアソン方程式をガウスーザイデル法で解いている。圧力に関して境界条件はノイマン型になるため、境界での圧力は反復のたび毎に修正する必要がある。したがってDO 23 のループのなかに圧力の境界条件を入れている。まずDO 285, DO 286のループで障害物境界上の圧力を計算している。最も簡単に、境界格子の圧力がその格子と接している流体格子の圧力の平均になるようにしている。境界格子がひとつの流体格子とだけ接している場合は、この手続きは
　　　Lｄｐ／ｄｎ　＝　０
を意味する。DO 24, DO 25, DO 29 のループはダクト壁面および流出入口での境界条件で、この場合も簡単に圧力勾配が０という条件にしている。
　DO 26 のループで圧力の１回の反復を構成する。この場合、ガウス・ザイデル法の反復ではひとつの格子線上の修正量を計算したのち一括して圧力を修正している。修正量の二乗和が0.001 以下になったとき反復のループを抜けるほかに反復が一定回数を越しても次の時間ステップに進むようになっている。
　DO 27 のループではナビエ・ストークス方程式を用いて速度を時間発展させている。U,V,W をひとつの時間ステップ時間発展させその結果を配列D,Q,S に一旦記憶する。そしてすべての格子点でこの手続きが終ってから、DO 245のループでD,Q,S をU,V,W におきかえている。
  DO 28 以下は計算には直接関係ない結果の表示および出力の部分である。すなわちある断面内の速度を用いて２次元の流れ関数にあたるもの（３次元計算なので本来は存在しない）を計算するサブルーチンを呼び出し、それを近似的な等高線表示のためのサブルーチンを用いて表示する。
　サブルーチンSDATA は計算結果のファイル出力のためのサブルーチンである。
　サブルーチンPSI では速度U から流れ関数を計算する。主プログラムではスタガード格子を用いているため、このプログラムは不正確であるが、もともと流れ関数は存在せず参考のための出力に使うだけなのでため、あまり厳密なことは考えていない。
　サブルーチンOUT はFORTRAN のWRITE 文だけで簡単な等高線表示するプログラムである。

　メインプログラムの仕様
　配列
　　Ｕ　　　Ｘ方向の速度成分
　　Ｖ　　　Ｙ方向の速度成分
　　Ｗ　　　Ｚ方向の速度成分
　　Ｐ　　　圧力
　　Ｔ　　　温度
　　Ｑ　　　ポアソン方程式の右辺、Ｖの一時的な記憶場所
　　Ｄ　　　ポアソン方程式を解く場合に必要な係数、Ｕの一時的な記憶場所
　　Ｓ　　　障害物境界上での圧力、Ｗの一時的な記憶場所
　　Ｒ　　　流れ関数
　　ＩＦＬ　流体の有無を判別する配列
　　ＩＢＤ　流体の境界の位置を示す配列
　　ＩＷＴ　圧力の境界条件を決定するときの重み
　　ＵＬ　　圧力のひとつの格子線上の修正量
　　X,Y,Z   格子点のｘ，ｙ，ｚ座標
　  XG,XA,XB  ｘに関する微分を計算する場合に必要な係数
　  YG,YA,YB  ｙに関する微分を計算する場合に必要な係数
　  ZG,ZA,ZB  ｚに関する微分を計算する場合に必要な係数
　　XC,XD,YC,YD,ZC,ZD 圧力のポアソン方程式を解く場合に必要な係数

　変数
　　ID　　　Ｘ方向の最大の格子数
    JD　　　Ｙ方向の最大の格子数
    KD　　　Ｚ方向の最大の格子数
    I20　   Ｘ方向の実際の格子数（入力データ）
    J20     Ｙ方向の実際の格子数（入力データ）
    K20     Ｚ方向の実際の格子数（入力データ）
    DT      時間刻み幅　△ｔ
    RE　　　レイノルズ数
　　BX,BY,BZ  格子の集中化のためのパラメータ（１未満の正数、１に近い
　　　　　　　ほど集中度が増す
    LM      計算終了のタイムステップ数
    I21     I20 + 1
    J21     J20 + 1
    K21     K20 + 1
    I17　　 Ｘ方向にI17までは等間隔格子でI17以上では粗くなる
    I11     (I17+1)/2
    J11     (J21+1)/2
    K11     (K21+1)/2
    DDH     Ｋ方向格子幅
    I19     I20 + 1
    J19     J20 + 1
    K19     K20 + 1
    TD      1/DT
    R1      1/RE
    KM      ポアソン方程式の反復回数
　　FA,FB,FC   格子の座標を計算するときに用いる係数
　　BXA,BYA,BZA   格子の座標を計算するときに用いる係数
    STL     原点から格子点までの距離
　　IQQ     境界の種類を識別する指標
    U1,U2,U3  ｕのｘ，ｙ，ｚ微分
    V1,V2,V3  ｖのｘ，ｙ，ｚ微分
    W1,W2,W3  ｗのｘ，ｙ，ｚ微分
　　G1      誤差の二乗和
    UNX     ｕ∂ｕ／∂ｘ
    UNY     ｖ∂ｕ／∂ｙ
    UNZ     ｗ∂ｕ／∂ｚ
    VNX     ｕ∂ｖ／∂ｘ
    VNY     ｖ∂ｖ／∂ｙ
    VNZ     ｗ∂ｖ／∂ｚ
    WNX     ｕ∂ｗ／∂ｘ
    WNY     ｖ∂ｗ／∂ｙ
    WNZ     ｗ∂ｗ／∂ｚ
    UV      △ｕ　（ラプラシアン）
    VV      △ｖ　（ラプラシアン）
    WV      △ｗ　（ラプラシアン）
    ISV     データを保存する場合は１，しない場合は０

　サブルーチン　SDATA の仕様
    配列
　　Ｄ　　　ファイルに出力する配列
　　X,Y,Z   格子点のｘ，ｙ，ｚ座標
　　ID　　　Ｘ方向の最大の格子数
    JD　　　Ｙ方向の最大の格子数
    KD　　　Ｚ方向の最大の格子数
    I21　   Ｘ方向の実際の格子数
    J21     Ｙ方向の実際の格子数
    K21     Ｚ方向の実際の格子数

　サブルーチン　PSI の仕様
    配列
    U　　　 速度を記憶する配列
    R　　　 流れ関数を記憶する配列
    Y       １次元座標値を記憶する配列
　　変数
　　NX      ｘ方向の最大の格子数
    NY      ｙ方向の最大の格子数
    I21     ｘ方向の実際の格子数
    J21     ｙ方向の実際の格子数

　サブルーチン　OUT の仕様
　　流体解析Ｉ参照

