　プログラム　ＲＭ３Ｄ．ＦＯＲ

　このプログラムは３次元の室内気流の計算を行うためのプログラムである。プログラムＣＡＶ３Ｄ．ＦＯＲと構成はほぼ同じであるが、不等間隔格子を用いており、さらに熱の計算部分が加わっているため、プログラムが長くなっている。このプログラムもプログラム内のコメント文を読めばおおよそ何を行っているのか検討がつくと思われるが簡単に説明すると以下のようになる。
　はじめに計算に用いる配列を確保したのち、READ文で計算に必要なパラメータの読み込み（入力例はWRITE 文に記されている）、計算に使う変数の計算を行う。次に格子点の座標を計算する。DO 110, DO 115, DO 120のループでそれぞれ格子のｘ、ｙ，ｚ座標を計算する。直角座標をもとに１次元の座標変換を各方向に行っているだけであるため、１次元配列を用意すれば十分である。なお１次元の座標変換には本文の式(7.26),(7.27) を用いている。次にDO 15, DO 16, DO 17 のループで座標変換を行ったときに現れる導関数の係数を計算している。DO 39 のループでは圧力のポアソン方程式を反復法で解く場合に現れる係数を計算している。さらにDO 20 のループで各変数に対して初期条件を与えている。
　DO 30 のループが時間発展的に基礎方程式を解いていくＭＡＣ法の時間発展の大きなループを構成する。DO 40, DO 41, DO 44, DO 45 , DO 43の各ループで速度および温度に関する境界条件を各壁面に対して与えている。　なおDO 44, DO 45のループはそれぞれ空気流入口および流出口の境界条件である。DO 22 のループでポアソン方程式の右辺を計算している。
　DO 23 のループで圧力のポアソン方程式をガウスーザイデル法で解いている。圧力に関して境界条件はノイマン型になるため、境界での圧力は反復のたび毎に修正する必要がある。したがってDO 23 のループのなかに圧力の境界条件（ DO 24, DO 25, DO 29のループ）を入れている。境界条件は圧力勾配が０という条件にしているが、レイノルズ数が低い場合には速度の２階微分を含んだ関係式におきかえる必要がある。たとえば、壁面がｘ軸に平行な場合には
　　　∂ｐ／∂ｙ＝(1／Re) ∂／∂ｙ（∂ｕ／∂ｙ）
を差分近似した式から決める。DO 26 のループで圧力の１回の反復を構成する。修正量の二乗和が0.001 以下になったとき反復のループを抜けるほかに反復が一定回数を越しても次の時間ステップに進むようになっている。
　DO 27 のループではナビエ・ストークス方程式および熱の移流方程式を用いて速度、温度を時間発展させている。正確には左辺のU,V,W,T に対しては別の配列を用意して全格子点での計算が終ってからU,V,W,T に置き換える必要があるが、ここではガウス・ザイデル法のように計算してもあまり結果は変わらない（むしろ定常解には速く到達する）と考えてこのようにしている。
  DO 28 以下は計算には直接関係ない結果の表示の部分である。すなわちある断面内の速度を用いて２次元の流れ関数にあたるもの（３次元計算なので本来は存在しない）を計算するサブルーチンを呼び出し、それを近似的な等高線表示のためのサブルーチンを用いて表示する。
　サブルーチンPSI では速度U および座標値から流れ関数を計算する。またサブルーチンOUT はFORTRAN のWRITE 文だけで簡単な等高線表示するプログラムである。

　メインプログラムの仕様
　配列
　　Ｕ　　　Ｘ方向の速度成分
　　Ｖ　　　Ｙ方向の速度成分
　　Ｗ　　　Ｚ方向
　　Ｐ　　　圧力
　　Ｔ　　　温度
　　Ｑ　　　ポアソン方程式の右辺
　　Ｄ　　　ポアソン方程式を解く場合に必要な係数
　　Ｒ　　　流れ関数
　　X,Y,Z   格子点のｘ，ｙ，ｚ座標
　  XG,XA,XB  ｘに関する微分を計算する場合に必要な係数
　  YG,YA,YB  ｙに関する微分を計算する場合に必要な係数
　  ZG,ZA,ZB  ｚに関する微分を計算する場合に必要な係数
　　XC,XD,YC,YD,ZC,ZD 圧力のポアソン方程式を解く場合に必要な係数

　変数
　　MX　　　Ｘ方向の最大の格子数
    MY　　　Ｙ方向の最大の格子数
    MZ　　　Ｚ方向の最大の格子数
    I20　   Ｘ方向の実際の格子数（入力データ）
    J20     Ｙ方向の実際の格子数（入力データ）
    K20     Ｚ方向の実際の格子数（入力データ）
    DT      時間刻み幅　△ｔ
    RE　　　レイノルズ数
　　BX,BY,BZ  格子の集中化のためのパラメータ（１未満の正数、１に近い
　　　　　　　ほど集中度が増す）
    LM      計算終了のタイムステップ数
    I21     I20 + 1
    J21     J20 + 1
    K21     K20 + 1
    I19     I20 + 1
    J19     J20 + 1
    K19     K20 + 1
    TD      1/DT
    R1      1/RE
    KM      ポアソン方程式の反復回数
　　FA,FB,FC  格子の座標を計算するときの係数
    PR      プラントル数
    R2      1/(PR*RE)
    AR      グラスホフ数／レイノルズ数の２乗
　　BXA,BYA,BZA   格子の座標を計算するときの係数
　　J7,J14  空気流出入部の幅（格子番号J7からJ14 の間に流出入口がある）
　　K16,K18 空気流入口の高さ（格子番号K16からK18の間に流入口がある）
　　K4,K6   空気流出口の高さ（格子番号K4からK6の間に流出口がある）
    U1,U2,U3  ｕのｘ，ｙ，ｚ微分
    V1,V2,V3  ｖのｘ，ｙ，ｚ微分
    W1,W2,W3  ｗのｘ，ｙ，ｚ微分
    T3      Ｔのｚ微分
　　G1      誤差の二乗和
    PCOR    圧力の修正量
    UNX     ｕ∂ｕ／∂ｘ
    UNY     ｖ∂ｕ／∂ｙ
    UNZ     ｗ∂ｕ／∂ｚ
    VNX     ｕ∂ｖ／∂ｘ
    VNY     ｖ∂ｖ／∂ｙ
    VNZ     ｗ∂ｖ／∂ｚ
    WNX     ｕ∂ｗ／∂ｘ
    WNY     ｖ∂ｗ／∂ｙ
    WNZ     ｗ∂ｗ／∂ｚ
    TNX     ｕ∂Ｔ／∂ｘ
    TNY     ｖ∂Ｔ／∂ｙ
    TNZ     ｗ∂Ｔ／∂ｚ
    UV      △ｕ　（ラプラシアン）
    VV      △ｖ　（ラプラシアン）
    WV      △ｗ　（ラプラシアン）
    TV      △Ｔ　（ラプラシアン）
    ISAVE   データを保存する場合は１　しない場合は０

　サブルーチン　PSI の仕様
    配列
    U　　　 速度を記憶する配列
    R　　　 流れ関数を記憶する配列
    Y       １次元座標値を記憶する配列
　　変数
　　NX      ｘ方向の最大の格子数
    NY      ｙ方向の最大の格子数
    I21     ｘ方向の実際の格子数
    J21     ｙ方向の実際の格子数

　サブルーチン　OUT の仕様
　　流体解析Ｉ参照

